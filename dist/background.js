(()=>{"use strict";async function e(e){try{return new URL(e).hostname}catch{return""}}async function t(e){const t=(await chrome.storage.sync.get("darkModeSites")).darkModeSites||{};return t[e]?.enabled||!1}async function a(){const[a]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!a?.id||!a.url)return;const n=await e(a.url);if(!n)return;console.log("Running dark mode script"),await chrome.scripting.executeScript({target:{tabId:a.id},files:["content.js"]}),await async function(e){const t=(await chrome.storage.sync.get("darkModeSites")).darkModeSites||{};t[e]?.enabled?delete t[e]:t[e]={enabled:!0,timestamp:Date.now()},await chrome.storage.sync.set({darkModeSites:t})}(n);const o=await t(n);chrome.tabs.sendMessage(a.id,{action:"toggle-dark-mode",state:o})}chrome.tabs.onUpdated.addListener((async(a,n,o)=>{if("complete"===n.status&&o.url){const n=await e(o.url);if(!n)return;await t(n)&&(await chrome.scripting.executeScript({target:{tabId:a},files:["content.js"]}),chrome.tabs.sendMessage(a,{action:"toggle-dark-mode",state:!0}))}})),chrome.commands.onCommand.addListener((e=>{"toggle-dark-mode"===e&&a()})),chrome.action.onClicked.addListener((()=>{console.log("Running dark mode script"),a()}))})();